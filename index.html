
   <!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Agrosphere Dashboard</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ðŸŒ¿</text></svg>">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <link href="https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css" rel="stylesheet">
    
    <!-- Firebase SDK Scripts -->
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database-compat.js"></script>

    <!-- PWA Manifest Link -->
    <link rel="manifest" href="manifest.json">
    <!-- Theme color for browser UI -->
    <meta name="theme-color" content="#22c55e">

     <link rel="stylesheet" href="style.css">
</head>
<body class="light">
    <script src="script.js"></script>

    <div id="leaf-particle-container" class="leaf-particle-container"></div>
    <div id="toast-container"></div>

    <!-- Tips Page -->
    <div id="tips-page" class="fixed inset-0 bg-green-100 dark:bg-green-900 flex flex-col items-center justify-center z-[9999] hidden text-center p-8">
        <div class="max-w-xl">
            <i class='bx bxs-leaf text-6xl text-green-600 dark:text-green-400 mb-4'></i>
            <h2 class="text-2xl font-bold text-green-800 dark:text-green-200 mb-2">Gardening Tip:</h2>
            <p id="gardening-tip" class="text-xl text-green-700 dark:text-green-300"></p>
        </div>
    </div>


    <div id="auth-container" class="min-h-screen flex items-center justify-center relative z-10">
        <div class="w-full max-w-md h-[620px]">
            <div class="flip-card" id="flip-card">
                <div class="flip-card-inner">
                    <div class="flip-card-front">
                        <div class="form-container p-8 md:p-12 h-full flex flex-col justify-center">
                            <div class="text-center mb-6"><i class='bx bxs-leaf text-6xl text-green-800'></i><h1 class="text-3xl font-bold text-green-900 mt-2">Welcome Back</h1><p class="text-gray-700">Login to your garden</p></div>
                            <form onsubmit="event.preventDefault(); login();">
                                <div class="space-y-4">
                                    <input id="login-email" type="email" placeholder="Email" required autocomplete="email" class="w-full p-3 bg-white/50 rounded-lg border border-white/30 focus:outline-none focus:ring-2 focus:ring-green-600">
                                    <input id="login-password" type="password" placeholder="Password" required autocomplete="current-password" class="w-full p-3 bg-white/50 rounded-lg border border-white/30 focus:outline-none focus:ring-2 focus:ring-green-600">
                                    <button id="login-button" type="submit" class="w-full p-3 bg-green-700 text-white rounded-lg font-semibold hover:bg-green-800 transition-colors disabled:opacity-50">Login</button>
                                </div>
                            </form>
                            <div class="flex items-center my-4">
                                <div class="flex-grow border-t border-gray-400"></div><span class="flex-shrink mx-4 text-gray-600 text-sm">OR</span><div class="flex-grow border-t border-gray-400"></div>
                            </div>
                            <button onclick="loginWithGoogle()" class="w-full p-3 bg-white text-gray-700 rounded-lg font-semibold border border-gray-300 hover:bg-gray-100 transition-colors flex items-center justify-center gap-2">
                                <i class='bx bxl-google text-xl'></i><span>Login with Google</span>
                            </button>
                            <p id="login-feedback" class="text-center text-sm font-semibold text-red-600 h-5 mt-2"></p>
                            <p class="text-center text-sm text-gray-700 mt-6">Don't have an account? <a href="#" onclick="flipToRegister()" class="font-semibold text-green-800 hover:underline">Register here</a></p>
                        </div>
                    </div>
                    <div class="flip-card-back">
                        <div class="form-container p-8 md:p-12 h-full flex flex-col justify-center">
                            <div class="text-center mb-8"><i class='bx bxs-florist text-6xl text-green-800'></i><h1 class="text-3xl font-bold text-green-900 mt-2">Create Account</h1><p class="text-gray-700">Start your journey with us</p></div>
                             <form onsubmit="event.preventDefault(); register();">
                                <div class="space-y-5">
                                    <input id="reg-username" type="text" placeholder="Your Name" required autocomplete="name" class="w-full p-3 bg-white/50 rounded-lg border border-white/30 focus:outline-none focus:ring-2 focus:ring-green-600">
                                    <input id="reg-email" type="email" placeholder="Your Email" required autocomplete="email" class="w-full p-3 bg-white/50 rounded-lg border border-white/30 focus:outline-none focus:ring-2 focus:ring-green-600">
                                    <input id="reg-password" type="password" placeholder="Create a Password" required autocomplete="new-password" class="w-full p-3 bg-white/50 rounded-lg border border-white/30 focus:outline-none focus:ring-2 focus:ring-green-600">
                                    <button id="register-button" type="submit" class="w-full p-3 bg-green-700 text-white rounded-lg font-semibold hover:bg-green-800 transition-colors disabled:opacity-50">Register</button>
                                </div>
                            </form>
                            <p id="register-feedback" class="text-center text-sm font-semibold h-5 mt-2"></p>
                            <p class="text-center text-sm text-gray-700 mt-4">Already have an account? <a href="#" onclick="flipToLogin()" class="font-semibold text-green-800 hover:underline">Login here</a></p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <div id="dashboard-container" class="hidden relative z-10">
        <div id="mobile-overlay" class="hidden lg:hidden fixed inset-0 bg-black bg-opacity-50 z-30" onclick="toggleSidebar()"></div>
        <button onclick="toggleSidebar()" class="sidebar-toggle hidden p-2 rounded-full bg-white/50 dark:bg-black/50 backdrop-blur-sm"><i class='bx bx-menu text-2xl'></i></button>
        <div id="app-container" class="flex h-screen">
            <aside class="sidebar flex-shrink-0 p-4 flex flex-col justify-between shadow-lg">
                <div class="h-full flex flex-col">
                    <div class="logo-container flex items-center justify-between px-2 mb-8 h-10 flex-shrink-0"><a href="#" class="relative text-3xl font-bold tracking-wider whitespace-nowrap logo-text" style="color: var(--text-color);"><svg aria-hidden="true" class="absolute -top-3 -left-4 w-10 h-10 text-green-500" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M15.25,8.25a.75.75,0,0,0,-1.5,0v2.51a3.5,3.5,0,0,1,-3.25,3.49v-2.5a.75.75,0,0,0,-1.5,0v2.5a3.5,3.5,0,0,1,-3.25-3.49V8.25a.75.75,0,0,0,-1.5,0v2.51c0,2.68,2.04,4.9,4.75,4.99V16a.75.75,0,0,0,1.5,0v-.25c2.71-.1,4.75-2.31,4.75-4.99V8.25Z" clip-rule="evenodd" /><path fill-rule="evenodd" d="M10,2a.75.75,0,0,1,.75.75v10.5a.75.75,0,0,1-1.5,0V2.75A.75.75,0,0,1,10,2Z" clip-rule="evenodd" /></svg><span class="relative z-10">A</span>grosphere</a><button onclick="toggleSidebar()" class="p-2 rounded-full hover:bg-gray-200 dark:hover:bg-gray-700"><i class='bx bx-menu text-2xl'></i></button></div>
                    <nav class="space-y-2 overflow-y-auto">
                        <a href="#dashboard" onclick="showSection('dashboard')" class="sidebar-link relative active flex items-center gap-3 px-4 py-3 rounded-xl transition-all hover:bg-green-500 hover:text-white"><i class='bx bxs-dashboard text-2xl text-gray-500'></i><span class="font-semibold whitespace-nowrap">Dashboard</span><span class="tooltip">Dashboard</span></a>
                        <a href="#history" onclick="showSection('history')" class="sidebar-link relative flex items-center gap-3 px-4 py-3 rounded-xl transition-all hover:bg-green-500 hover:text-white"><i class='bx bx-history text-2xl text-gray-500'></i><span class="font-semibold whitespace-nowrap">History Logs</span><span class="tooltip">History Logs</span></a>
                        <a href="#controls" onclick="showSection('controls')" class="sidebar-link relative flex items-center gap-3 px-4 py-3 rounded-xl transition-all hover:bg-green-500 hover:text-white"><i class='bx bxs-droplet-half text-2xl text-gray-500'></i><span class="font-semibold whitespace-nowrap">Manual Controls</span><span class="tooltip">Manual Controls</span></a>
                    </nav>
                </div>
                <div class="flex-shrink-0">
                    <a href="#settings" onclick="showSection('settings')" class="sidebar-link relative flex items-center gap-3 px-4 py-3 rounded-xl transition-all hover:bg-green-500 hover:text-white"><i class='bx bxs-cog text-2xl text-gray-500'></i><span class="font-semibold whitespace-nowrap">Settings</span><span class="tooltip">Settings</span></a>
                    <a href="#" onclick="logout()" class="sidebar-link relative flex items-center gap-3 px-4 py-3 rounded-xl transition-all hover:bg-red-500 hover:text-white mt-2"><i class='bx bx-log-out text-2xl text-gray-500'></i><span class="font-semibold whitespace-nowrap">Logout</span><span class="tooltip">Logout</span></a>
                </div>
            </aside>
            <main class="flex-1 p-6 lg:p-8 overflow-y-auto relative">
                <section id="dashboard-section">
                    <div id="skeleton-loader"><div class="flex justify-between items-center mb-6"><div class="space-y-2"><div class="skeleton skeleton-card h-9 w-72 rounded-lg"></div><div class="skeleton skeleton-card h-5 w-48 rounded-md"></div></div><div class="skeleton skeleton-card h-24 w-72 rounded-2xl"></div></div><div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-6"><div class="skeleton skeleton-card h-24 rounded-2xl"></div><div class="skeleton skeleton-card h-24 rounded-2xl"></div><div class="skeleton skeleton-card h-24 rounded-2xl"></div><div class="skeleton skeleton-card h-24 rounded-2xl"></div></div><div class="skeleton skeleton-card h-96 w-full rounded-2xl"></div></div>
                    <div id="dashboard-content" class="hidden">
                        <div class="grid grid-cols-1 xl:grid-cols-5 gap-6 mb-6">
                            <div class="xl:col-span-3">
                                <h1 id="greeting-text" class="text-3xl font-bold">Good Morning!</h1>
                                <p class="text-gray-500 dark:text-gray-400" id="current-date">--</p>
                                <div class="flex items-end gap-2 mt-4">
                                    <div id="plant-profile-container" class="relative w-full sm:w-64">
                                        <label class="block text-sm font-medium text-gray-500 dark:text-gray-400">Current Profile</label>
                                        <input type="text" id="plant-search-input" placeholder="Search for a plant..." class="w-full p-2 mt-1 border rounded-lg bg-gray-50 dark:bg-gray-800 focus:outline-none focus:ring-2 focus:ring-green-500">
                                        <div id="plant-dropdown" class="hidden absolute w-full bg-white dark:bg-gray-800 shadow-lg rounded-lg mt-1 max-h-60 overflow-y-auto z-20"></div>
                                    </div>
                                    <button onclick="openProfileModal()" class="p-2 h-11 bg-green-500 text-white rounded-lg hover:bg-green-600 text-2xl self-end">+</button>
                                </div>
                            </div>
                            <div id="weather-card" class="card p-4 flex flex-col gap-4 shadow-lg xl:col-span-2">
                                <div class="flex justify-between items-start">
                                    <div><p id="weather-city" class="font-bold">--</p><p id="weather-desc" class="text-gray-500 dark:text-gray-400 text-sm">Loading...</p></div>
                                    <i id="weather-icon" class='bx bx-cloud text-5xl text-gray-400'></i>
                                </div>
                                <p id="weather-temp" class="text-5xl font-bold self-center my-2">--Â°C</p>
                                <div id="weather-alerts-container" class="text-sm"></div>
                            </div>
                        </div>

                        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-5 gap-6 mb-6">
                            <div class="card p-6 flex flex-col items-center justify-center text-center lg:col-span-1 sm:col-span-2"><i id="health-icon" class='bx bx-loader-alt bx-spin text-6xl text-gray-400'></i><h3 id="health-score" class="text-4xl font-bold mt-2">--%</h3><p id="health-status" class="font-semibold text-gray-400">Calculating...</p></div>
                            <div class="card p-6 flex items-center gap-4"><i class='bx bxs-thermometer text-5xl text-red-500'></i><div><p class="text-gray-400">Temperature</p><h3 class="text-3xl font-bold"><span id="temp-val">--</span><span class="text-2xl text-gray-500">Â°C</span></h3></div></div>
                            <div class="card p-6 flex items-center gap-4"><i class='bx bxs-droplet text-5xl text-blue-500'></i><div><p class="text-gray-400">Humidity</p><h3 class="text-3xl font-bold"><span id="hum-val">--</span><span class="text-2xl text-gray-500">%</span></h3></div></div>
                            <div class="card p-6 flex items-center gap-4"><i class='bx bxs-florist text-5xl text-yellow-600'></i><div><p class="text-gray-400">Soil Moisture</p><h3 class="text-3xl font-bold"><span id="soil-val">--</span><span class="text-2xl text-gray-500">%</span></h3></div></div>
                            <div class="card p-6 flex items-center gap-4"><i class='bx bxs-sun text-5xl text-amber-500'></i><div><p class="text-gray-400">Light</p><h3 class="text-3xl font-bold"><span id="light-val">--</span><span class="text-2xl text-gray-500"> lux</span></h3></div></div>
                        </div>
                        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                            <div class="lg:col-span-2 card p-6"><h3 class="text-xl font-semibold mb-4">ðŸ“Š Live Sensor Data</h3><div class="h-80 relative"><canvas id="live-chart"></canvas><div id="chart-overlay" class="absolute inset-0 bg-white/70 dark:bg-gray-800/70 flex-col items-center justify-center text-center p-4 rounded-lg hidden"><i class='bx bx-wifi-off text-5xl text-gray-400'></i><p class="mt-2 font-semibold text-gray-500 dark:text-gray-400">Hardware Disconnected</p><p class="text-sm text-gray-400">Graph will resume when data is received.</p></div></div></div>
                            <div class="space-y-6">
                                <div class="card p-6"><h3 class="text-xl font-semibold mb-2">ðŸ“· Last Snapshot</h3><img id="last-snapshot-img" src="https://placehold.co/400x300/e2e8f0/e2e8f0?text=Waiting+for+image..." alt="Last plant snapshot" class="rounded-lg mb-2 cursor-pointer transition-transform hover:scale-105" onclick="openModal(this.src)"><p class="text-sm text-gray-400">Captured: <span id="last-snapshot-time">--</span></p></div>
                                <div class="card p-6"><h3 class="text-xl font-semibold mb-2">ðŸš¨ Notifications</h3><ul id="notifications-list" class="space-y-2 text-sm max-h-24 overflow-y-auto"><li class="text-gray-400">No new notifications.</li></ul></div>
                            </div>
                        </div>
                    </div>
                </section>
                <section id="history-section" class="hidden">
                    <h1 class="text-3xl font-bold mb-6">History Logs</h1>
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                        <div class="card p-6"><h3 class="text-xl font-semibold mb-4">ðŸ“… Sensor Data History</h3><div class="max-h-96 overflow-y-auto"><table class="w-full text-left text-sm"><thead class="border-b-2"><tr><th class="p-2">Time</th><th>Temp</th><th>Humid</th><th>Soil %</th><th>Light (lux)</th></tr></thead><tbody id="sensor-history-body"></tbody></table></div></div>
                        <div class="card p-6"><h3 class="text-xl font-semibold mb-4">ðŸ’§ Sprinkler Log</h3><div class="max-h-96 overflow-y-auto"><table class="w-full text-left text-sm"><thead class="border-b-2"><tr><th class="p-2">Time</th><th>Duration</th><th>Reason</th></tr></thead><tbody id="sprinkler-log-body"></tbody></table></div></div>
                    </div>
                    <div class="card p-6 mt-6"><h3 class="text-xl font-semibold mb-4">ðŸ“¸ Image History</h3><div id="image-history-gallery" class="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 gap-4"><div class="text-gray-400 col-span-full text-center p-8"><i class='bx bx-image-alt text-5xl mb-2'></i><p>No images received yet.</p></div></div></div>
                </section>
                <section id="controls-section" class="hidden">
                    <h1 class="text-3xl font-bold mb-6">Manual System Controls</h1>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div class="card p-8"><h3 class="text-xl font-semibold mb-4">ðŸ’§ Manual Sprinkler Trigger</h3><p class="text-gray-400 mb-4">Activate the sprinkler for a specific duration.</p><div class="flex items-center gap-4"><div class="relative flex-grow"><input id="spray-duration" type="number" min="1" value="5" class="w-full p-3 rounded-lg border focus:outline-none focus:ring-2 focus:ring-green-600"><span class="absolute right-3 top-1/2 -translate-y-1/2 text-gray-400">seconds</span></div><button onclick="manualSpray()" class="bg-green-600 hover:bg-green-700 text-white font-bold py-3 px-6 rounded-lg transition">Trigger Now</button></div></div>
                        <div class="card p-8"><h3 class="text-xl font-semibold mb-4">ðŸ”„ System Health & Restart</h3><div class="flex items-center justify-between mb-4"><div class="flex items-center gap-2"><div id="system-status-indicator" class="w-4 h-4 rounded-full bg-yellow-400 animate-pulse"></div><span id="system-status-text">Connecting...</span></div><span class="text-sm text-gray-400">Last update: <span id="last-update-time">--</span></span></div><button onclick="showToast('System restart command sent!', 'info')" class="w-full bg-red-600 hover:bg-red-700 text-white font-bold py-3 px-4 rounded-lg transition">Restart ESP32 System</button></div>
                    </div>
                </section>
                <section id="settings-section" class="hidden">
                    <h1 class="text-3xl font-bold mb-6">Settings</h1>
                    <div class="max-w-2xl mx-auto card p-8">
                         <div class="space-y-6">
                            <div class="flex justify-between items-center p-4 rounded-lg border"><span>Enable Dark Mode</span><label class="relative inline-flex items-center cursor-pointer"><input type="checkbox" id="dark-mode-toggle" class="sr-only peer"><div class="w-11 h-6 bg-gray-200 peer-focus:outline-none rounded-full peer dark:bg-gray-700 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all dark:border-gray-600 peer-checked:bg-green-600"></div></label></div>
                            <div class="flex justify-between items-center p-4 rounded-lg border"><span>Enable Email Alerts</span><label class="relative inline-flex items-center cursor-pointer"><input type="checkbox" class="sr-only peer" checked><div class="w-11 h-6 bg-gray-200 peer-focus:outline-none rounded-full peer dark:bg-gray-700 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all dark:border-gray-600 peer-checked:bg-green-600"></div></label></div>
                        </div>
                    </div>
                </section>
            </main>
        </div>
    </div>
    
    <div id="image-modal" class="hidden fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50" onclick="closeModal()">
        <span class="absolute top-4 right-6 text-white text-5xl font-bold cursor-pointer">&times;</span>
        <img id="modal-img" src="" alt="Full-size snapshot" class="max-w-[90vw] max-h-[90vh] rounded-lg" onclick="event.stopPropagation()">
    </div>
    
    <div id="add-profile-modal" class="hidden fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center z-50">
        <div class="card p-8 rounded-2xl w-full max-w-lg relative">
            <button onclick="closeProfileModal()" class="absolute top-4 right-4 text-2xl">&times;</button>
            <h3 class="text-2xl font-bold mb-4">Add New Plant Profile</h3>
            <div class="space-y-4">
                <input id="new-plant-name" type="text" placeholder="Plant Name (e.g., Basil)" class="w-full p-2 border rounded-lg bg-transparent">
                <div class="grid grid-cols-2 gap-4"><input id="new-temp-min" type="number" placeholder="Min Temp (Â°C)" class="w-full p-2 border rounded-lg bg-transparent"><input id="new-temp-max" type="number" placeholder="Max Temp (Â°C)" class="w-full p-2 border rounded-lg bg-transparent"></div>
                <div class="grid grid-cols-2 gap-4"><input id="new-humidity-min" type="number" placeholder="Min Humidity (%)" class="w-full p-2 border rounded-lg bg-transparent"><input id="new-humidity-max" type="number" placeholder="Max Humidity (%)" class="w-full p-2 border rounded-lg bg-transparent"></div>
                <div class="grid grid-cols-2 gap-4"><input id="new-soil-min" type="number" placeholder="Min Soil Moisture (%)" class="w-full p-2 border rounded-lg bg-transparent"><input id="new-soil-max" type="number" placeholder="Max Soil Moisture (%)" class="w-full p-2 border rounded-lg bg-transparent"></div>
                <div class="grid grid-cols-2 gap-4"><input id="new-light-min" type="number" placeholder="Min Light (lux)" class="w-full p-2 border rounded-lg bg-transparent"><input id="new-light-max" type="number" placeholder="Max Light (lux)" class="w-full p-2 border rounded-lg bg-transparent"></div>
                <button onclick="saveNewProfile()" class="w-full p-3 bg-green-600 text-white rounded-lg font-semibold hover:bg-green-700">Save Profile</button>
            </div>
        </div>
    </div>
</body>
</html>